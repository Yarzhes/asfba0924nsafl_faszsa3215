# S6-T9: Reports and Artifacts Format Specification

## 1. Introduction

This document defines the standardized formats for all data artifacts generated by backtesting and walk-forward analysis runs. The purpose is to ensure consistency, enable programmatic analysis, and provide clear, human-readable reports.

## 2. File Naming Convention

All output files generated from a single analysis run will be stored in a directory that is uniquely named to identify the run. The directory and file names will follow a consistent convention to avoid collisions and maintain organization.

### 2.1. Run Directory Naming

A unique directory will be created for each run, named as follows:

`{run_timestamp}_{strategy_name}_{run_type}`

-   **`run_timestamp`**: The UTC timestamp when the run was initiated, in `YYYYMMDD-HHMMSS` format.
-   **`strategy_name`**: A short, descriptive name for the strategy being tested (e.g., `funding_momentum`, `ob_reversal`).
-   **`run_type`**: The type of analysis (`backtest` or `walk_forward`).

**Example Directory Name:** `20250822-194500_funding_momentum_backtest`

### 2.2. Artifact File Naming

Within the run directory, artifact files will be named according to their content and the specific parameters of the test.

-   **`{symbol}_{artifact_type}.{extension}`**

-   **`symbol`**: The trading symbol (e.g., `BTCUSDT`). For portfolio-level reports, `portfolio` will be used.
-   **`artifact_type`**: A descriptor for the file's content (e.g., `trades`, `equity_curve`, `summary_report`, `reliability_diagram`).
-   **`extension`**: The file extension (`.csv`, `.json`, `.md`).

**Example File Names inside the directory:**
-   `BTCUSDT_trades.csv`
-   `portfolio_equity_curve.csv`
-   `portfolio_summary_report.md`
-   `ETHUSDT_reliability_diagram.json`

## 3. Artifact Specifications

### 3.1. Trade Log

The trade log provides a detailed record of every simulated trade executed during the run. It will be provided in both CSV and JSON formats.

#### 3.1.1. Trade Log (CSV)

-   **File Name**: `{symbol}_trades.csv`
-   **Format**: Comma-Separated Values (CSV) with a header row.
-   **Schema**:

| Column          | Type      | Description                                                                                             |
|-----------------|-----------|---------------------------------------------------------------------------------------------------------|
| `trade_id`      | string    | A unique identifier for the trade.                                                                      |
| `symbol`        | string    | The trading symbol (e.g., `BTCUSDT`).                                                                   |
| `entry_time`    | datetime  | The UTC timestamp of the trade entry (ISO 8601 format).                                                   |
| `exit_time`     | datetime  | The UTC timestamp of the trade exit (ISO 8601 format).                                                    |
| `direction`     | string    | The direction of the trade (`LONG` or `SHORT`).                                                        |
| `entry_price`   | float     | The average price at which the position was opened.                                                     |
| `exit_price`    | float     | The average price at which the position was closed.                                                     |
| `size`          | float     | The quantity of the asset traded (in base currency).                                                    |
| `pnl`           | float     | The net profit or loss from the trade, after fees.                                                      |
| `fees`          | float     | The total transaction fees paid for the trade.                                                          |
| `exit_reason`   | string    | The reason for the trade's closure (e.g., `TAKE_PROFIT`, `STOP_LOSS`, `TRAILING_STOP_LOSS`, `END_OF_BACKTEST`). |
| `raw_score`     | float     | The raw confidence score from the model for this trade signal.                                          |
| `cal_prob`      | float     | The calibrated probability associated with the signal after calibration.                                |

#### 3.1.2. Trade Log (JSON)

-   **File Name**: `{symbol}_trades.json`
-   **Format**: A JSON array where each object represents a single trade.
-   **Schema**:

```json
[
  {
    "trade_id": "trade_001",
    "symbol": "BTCUSDT",
    "entry_time": "2025-08-20T10:00:00Z",
    "exit_time": "2025-08-20T14:30:00Z",
    "direction": "LONG",
    "entry_price": 50000.0,
    "exit_price": 50500.0,
    "size": 0.1,
    "pnl": 49.5,
    "fees": 0.5,
    "exit_reason": "TAKE_PROFIT",
    "raw_score": 0.85,
    "cal_prob": 0.92
  }
]
```

### 3.2. Equity Curve Data (CSV)

This file contains the data needed to plot the portfolio's equity curve over time.

-   **File Name**: `portfolio_equity_curve.csv`
-   **Format**: CSV with a header row.
-   **Schema**:

| Column          | Type      | Description                                           |
|-----------------|-----------|-------------------------------------------------------|
| `timestamp`     | datetime  | The UTC timestamp for the data point (ISO 8601 format). |
| `cumulative_pnl`| float     | The cumulative profit and loss of the portfolio at that time. |
| `equity`        | float     | The total portfolio equity at that time.              |

### 3.3. Reliability Diagram Data (JSON)

This file provides the aggregated data required to plot a reliability diagram, as defined in `S6-T8-Confidence-Calibration-Spec.md`.

-   **File Name**: `{symbol}_reliability_diagram.json`
-   **Format**: A JSON array where each object represents one bin.
-   **Schema**:

```json
[
  {
    "bin_number": 1,
    "bin_range": [0.0, 0.1],
    "mean_predicted_value": 0.05,
    "true_fraction_of_positives": 0.04,
    "n_samples": 150
  },
  {
    "bin_number": 2,
    "bin_range": [0.1, 0.2],
    "mean_predicted_value": 0.15,
    "true_fraction_of_positives": 0.16,
    "n_samples": 200
  }
]
```

### 3.4. Summary Report (Markdown)

A human-readable summary report detailing the overall performance and configuration of the run.

-   **File Name**: `portfolio_summary_report.md`
-   **Format**: Markdown.
-   **Structure**:

````markdown
# Backtest Summary Report

- **Strategy Name**: `funding_momentum`
- **Run Type**: `Backtest`
- **Date Range**: `2024-01-01` to `2024-12-31`
- **Symbols**: `BTCUSDT, ETHUSDT`
- **Run Timestamp**: `20250822-194500`

---

## Performance Summary & KPI Gates

This section provides the final performance metrics and evaluates them against the established KPI gates from `S6-T7`.

| KPI                    | Value      | Threshold | Status |
|------------------------|------------|-----------|--------|
| Profit Factor          | 1.45       | > 1.2     | PASS   |
| Hit Rate               | 42%        | > 35%     | PASS   |
| Average R:R            | 1.8        | > 1.5     | PASS   |
| Maximum Drawdown       | -15.3%     | < 20%     | PASS   |
| Sharpe Ratio           | 1.1        | > 1.0     | PASS   |
| Sortino Ratio          | 1.9        | > 1.5     | PASS   |
| Matthews Corr. Coeff.  | 0.15       | > 0.1     | PASS   |
| **Overall Result**     | -          | -         | **PASS** |

---

## Walk-Forward Analysis Summary

*(This section is only included for `walk_forward` run types.)*

### Walk-Forward Periods

| Period | Start Date | End Date   | In-Sample PnL | Out-of-Sample PnL |
|--------|------------|------------|---------------|-------------------|
| 1      | 2024-01-01 | 2024-03-31 | $5,000        | $1,200            |
| 2      | 2024-04-01 | 2024-06-30 | $6,200        | $1,500            |

### Overall Walk-Forward Stability

- **Annualized Return Stability**: 0.85 (High)
- **Sharpe Ratio Stability**: 0.92 (High)

---

*This report was generated automatically at `2025-08-22 19:45:00 UTC`.*